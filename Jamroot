import package ;

import sequence ;
import xsltproc ;
import set ;
import path ;
import link ;
import os ;

local BOOST_ROOT = [ os.environ BOOST_ROOT ] ;

project boostconnect
    : requirements <include>.
      <define>BOOSTCONNECT_LIB_BUILD
      <toolset>gcc:<cxxflags>-std=gnu++11
      <toolset>clang:<cxxflags>-std=c++11
    : usage-requirements <include>.
    : build-dir bin.v2
    ;

#
# Collect build information
#
all-libraries = [ MATCH .*libs/(.*)/build/.* : [ glob libs/*/build/Jamfile.v2 ] [ glob libs/*/build/Jamfile ] ] ;
#all-libraries = [ sequence.unique $(all-libraries) ] ;
#all-libraries = [ set.difference $(all-libraries) : function_types ] ;

local libraries = $(all-libraries) ;
local headers = [ path.glob-tree boostconnect : *.hpp *.ipp *.h *.ipp ] ;

#
# Data show options process
#
if --show-all-libraries in [ modules.peek : ARGV ]
{
    echo "Following libraries are exist:" ;
    for local l in $(all-libraries)
    {
        echo "     - $(l)" ;
    }
    exit ;
}

if --show-libraries in [ modules.peek : ARGV ]
{
    echo "Following libraries are building target:" ;
    for local l in $(libraries)
    {
        echo "     - $(l)" ;
    }
    exit ;
}

#
# Build
#
for local l in $(all-libraries)
{
    use-project /boostconnect/$(l) : libs/$(l)/build ;
    build-project libs/$(l)/build ;
}

#
# Install
#
install pre-headers  
    : $(headers)
    : <location>stage/include <install-source-root>./
    ;

install build-libs  
    : libs/client/build//bstcon_client
    : <location>stage/lib
    ;

